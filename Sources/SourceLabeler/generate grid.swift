//
//  File.swift
//  
//
//  Created by Damiaan on 12/06/2020.
//

import Foundation
import Atem

func createGrid() throws -> Data {
	var decompressed = Data(count: 320*90)

	for x in 0 ..< 320 * 50 { decompressed[x] = 0 }
	var number = UInt8(0)
	for row in 0..<8 {
		for col in 0..<32 {
			for x in 0..<8 {
				for y in 0..<5 {
					decompressed[(row*6 + y)*320 + (col*10 + x)] = number
				}
			}
			if number < .max {number += 1}
		}
	}

	let grid = Media.encodeRunLength(rawData: decompressed)
	try grid.write(to: URL(fileURLWithPath: "/tmp/compressedGrid.bin"))

	return grid
}

func createRect(color: UInt8) throws -> Data {
	var decompressed = Data(capacity: 320*90)
	for _ in 0 ..< 320*90 {
		decompressed.append(color)
	}
	return Media.encodeRunLength(rawData: decompressed)
}

let grayGradient: [UInt8] = [14, 85, 29, 132, 17, 96, 30, 77, 136, 186, 101, 50, 13, 19, 72, 217, 49, 130, 124, 123, 47, 51, 28, 32, 192, 166, 56, 167, 97, 193, 143, 172, 189, 198, 41, 154, 147, 61, 81, 109, 199, 108, 60, 37, 12, 15, 153, 21, 142, 68, 35, 173, 141, 27, 197, 144, 94, 116, 42, 185, 214, 40, 46, 184, 181, 83, 127, 175, 31, 150, 213, 73, 95, 86, 191, 117, 135, 112, 208, 22, 78, 107, 179, 114, 210, 119, 58, 67, 149, 209, 171, 110, 89, 103, 133, 43, 202, 137, 66, 39, 151, 129, 71, 200, 26, 111, 128, 11, 16, 23, 196, 201, 36, 106, 207, 205, 69, 139, 62, 105, 90, 203, 216, 54, 99, 20, 5, 4, 100, 88, 146, 145, 25, 74, 80, 204, 180, 84, 138, 212, 215, 24, 63, 33, 187, 118, 148, 183, 57, 91, 102, 206, 44, 152, 190, 126, 134, 59, 182, 87, 174, 48, 125, 104, 140, 188, 131, 92, 178, 64, 70, 76, 79, 65, 121, 113, 176, 211, 177, 52, 75, 120, 82, 38, 93, 98, 122, 53, 115, 55, 45, 34]
let TransparencyGradient: [UInt8] = [194, 168, 163, 160, 6, 155, 2, 229, 227, 222, 219, 195, 165, 164, 169, 161, 170, 162, 158, 9, 8, 3, 230, 226, 228, 221, 220]


/// Maps Grayscale value [0-255] to BMD atem label color values
let grayColorTable: [UInt8] = [14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 85, 85, 29, 132, 96, 96, 30, 77, 136, 136, 186, 101, 50, 13, 19, 72, 72, 217, 124, 124, 123, 47, 51, 51, 28, 192, 166, 56, 167, 193, 143, 189, 198, 198, 41, 154, 147, 61, 81, 109, 199, 199, 108, 37, 12, 12, 15, 153, 153, 142, 68, 68, 35, 173, 173, 197, 197, 144, 144, 94, 116, 116, 214, 214, 40, 40, 46, 184, 184, 181, 83, 127, 175, 31, 150, 213, 73, 73, 95, 86, 191, 117, 135, 135, 112, 208, 208, 78, 107, 179, 179, 114, 210, 210, 67, 67, 149, 149, 209, 171, 110, 110, 103, 133, 133, 43, 202, 137, 66, 39, 39, 151, 129, 71, 200, 200, 111, 128, 128, 11, 16, 23, 23, 196, 201, 36, 106, 207, 205, 205, 69, 139, 62, 105, 90, 203, 203, 216, 54, 99, 99, 4, 100, 88, 146, 145, 74, 74, 80, 204, 180, 180, 84, 138, 138, 215, 24, 24, 63, 33, 187, 187, 148, 183, 183, 57, 91, 102, 102, 206, 44, 190, 190, 126, 134, 134, 59, 182, 174, 174, 48, 125, 104, 104, 140, 188, 188, 131, 178, 64, 64, 70, 79, 79, 65, 121, 113, 113, 176, 211, 211, 177, 75, 120, 120, 82, 38, 93, 93, 98, 122, 122, 115, 55, 45, 45, 34]

/// Maps an 8 bit alpha channel value [0-255] to BMD atem label color values
let transparencyColorTable: [UInt8] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 194, 194, 194, 194, 194, 194, 194, 194, 194, 194, 194, 194, 168, 168, 163, 163, 160, 160, 160, 160, 160, 160, 160, 160, 160, 160, 160, 160, 160, 160, 160, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 155, 155, 2, 2, 229, 229, 227, 227, 222, 219, 219, 219, 219, 219, 219, 219, 195, 195, 195, 195, 195, 195, 195, 195, 165, 165, 165, 164, 164, 164, 169, 169, 169, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 162, 162, 162, 162, 162, 162, 162, 158, 158, 158, 158, 158, 158, 159, 9, 8, 8, 3, 3, 3, 3, 3, 3, 3, 230, 230, 230, 230, 230, 230, 230, 225, 226, 224, 221, 221, 220, 220]

func createGradient() throws -> Data {
	var decompressed = Data(count: 320*90)
	for (coordinate, color) in TransparencyGradient.enumerated() {
		for y in 0..<50 {
			for x in 0..<9 {
				decompressed[y*320 + 9*coordinate + x] = color
			}
		}
	}
	return Media.encodeRunLength(rawData: decompressed)
}
